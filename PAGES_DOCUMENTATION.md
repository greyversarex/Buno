# Документация публичных страниц Bunyod-Tour

## Обзор системы

Платформа Bunyod-Tour включает **12 основных публичных страниц**, каждая из которых выполняет специфическую бизнес-функцию. Все страницы интегрированы с централизованными системами и используют единую архитектуру.

### Централизованные системы

1. **Система интернационализации (i18n.js)**
   - Единый файл переводов для русского и английского языков
   - Автоматическая смена языка интерфейса
   - Функция `getTranslation(key)` для получения переводов
   - События `languageChanged` для динамического обновления

2. **Система управления изображениями (utils.js)**
   - Функция `getAbsoluteImageUrl()` для правильных путей к изображениям
   - Поддержка Replit-прокси и локальных путей
   - Автоматическая обработка fallback изображений

3. **Динамическая загрузка layout (layout-loader.js)**
   - Автоматическая загрузка header и footer на все страницы
   - Единообразное оформление навигации
   - Выпадающие меню с подменю

4. **Система валют**
   - Поддержка TJS, USD, EUR, RUB, CNY
   - Real-time конвертация через `/api/exchange-rates`
   - Хранение выбранной валюты в localStorage

---

## 1. Главная страница (index.html)

### Назначение
Точка входа платформы, представляет полный каталог туров с фильтрацией и hero-slider.

### API Эндпоинты
- `GET /api/tours` - получение всех активных туров
- `GET /api/tours/blocks` - получение туров по блокам (Популярные, Рекомендованные и т.д.)
- `GET /api/slides` - получение слайдов для hero-баннера
- `GET /api/exchange-rates` - получение курсов валют
- `GET /api/exchange-rates/map` - получение курсов в формате карты

### Ключевые особенности
1. **Hero Slider**
   - Автоматическая смена слайдов каждые 5 секунд
   - Навигация через точки-индикаторы
   - Градиентный оверлей для читаемости текста

2. **Tour Blocks System**
   - 6 блоков туров: Популярные, Рекомендованные, Горные, Озёрные, Исторические, Комбинированные
   - Горизонтальная прокрутка с кнопками навигации
   - Карточки туров с ценами и конвертацией валют

3. **Toggle Filter System**
   - Фильтрация по стране, городу, формату и тематике
   - Динамическая загрузка городов по выбранной стране
   - Раздвижная панель фильтров

4. **Services Section**
   - Анимированные иконки услуг (трансфер, гиды, визы)
   - Карточки с hover-эффектами

### Многоязычность
- Автоматическая загрузка переводов через `data-translate` атрибуты
- Динамическая смена контента туров (название, описание) на основе языка
- Multilingual JSON поля для туров: `{ ru: "текст", en: "text" }`

---

## 2. Каталог туров (tours.html)

### Назначение
Расширенный поиск и фильтрация всех доступных туров.

### API Эндпоинты
- `GET /api/tours` - получение всех туров с фильтрацией
- `GET /api/countries` - список стран для фильтра
- `GET /api/cities?country={country}` - города по стране

### Ключевые особенности
1. **Левая панель фильтров**
   - Направление (страна + город)
   - Формат тура (групповой, индивидуальный, VIP)
   - Длительность (однодневный, многодневный, длительный)
   - Тематика (9 категорий)
   - Даты проведения (от/до)

2. **Правая панель результатов**
   - Сетка карточек туров 3 колонки (desktop)
   - Счётчик результатов
   - Сообщение "Туры не найдены" при отсутствии результатов

3. **Modal окно деталей тура**
   - 3 вкладки: Описание, Программа, Отели
   - Динамическая загрузка контента из API
   - Inline загрузка без перехода на другую страницу

### Фильтрация
- Клиентская фильтрация после загрузки всех туров
- Мгновенное обновление результатов
- Сохранение состояния фильтров в сессии

---

## 3. Страница тура (tour-template.html)

### Назначение
Детальное представление одного тура со всеми компонентами и ценами.

### API Эндпоинты
- `GET /api/tours/{tourId}` - получение деталей тура
- `GET /api/tours/{tourId}/prices` - получение цен компонентов
- `GET /api/exchange-rates` - конвертация валют
- `POST /api/booking/draft` - создание черновика бронирования

### Ключевые особенности
1. **Галерея изображений**
   - Главное изображение с миниатюрами слева
   - Навигация стрелками (prev/next)
   - Кнопка "Ещё фото" для полного просмотра
   - Wishlist кнопка

2. **Tour Info Strip**
   - Длительность тура
   - Приём включен/не включен
   - Языки тура
   - Кнопка "Поделиться" (копирование ссылки, скачать PDF)

3. **Tour Details Tabs**
   - **Описание тура**: текст, включено/не включено
   - **Программа тура**: timeline с временами и активностями

4. **Правая панель - Booking Form**
   - Выбор даты тура (calendar)
   - Количество туристов (counter)
   - Расчёт стоимости с конвертацией валют
   - Кнопка "Забронировать сейчас" → переход на booking-step1.html

5. **Component-based Pricing**
   - Цена тура (за человека / за группу)
   - Цены услуг: гиды, транспорт, питание
   - Inline редактирование цен для админов
   - Автоматический пересчёт итоговой суммы

### Специфика работы
- URL параметр: `?tour={tourId}`
- Breadcrumb навигация с динамическим именем тура
- Рейтинг и отзывы (звёзды)
- Lightbox для галереи изображений

---

## 4. Каталог отелей (hotels-catalog.html)

### Назначение
Просмотр и поиск отелей по различным критериям.

### API Эндпоинты
- `GET /api/hotels` - получение всех активных отелей
- `GET /api/hotels?country={country}` - отели по стране
- `GET /api/hotels?category={category}` - отели по категории

### Ключевые особенности
1. **Фильтры**
   - Страна
   - Категория (бизнес, эконом, люкс)
   - Звёзды (1-5)
   - Поиск по названию

2. **Сетка отелей**
   - Карточки с фото, названием, звёздами
   - Адрес с иконкой
   - Удобства (amenities) - первые 3
   - Кнопка "Подробнее" → hotel-template.html

3. **Динамический счётчик**
   - "Показано X из Y отелей"
   - Обновление при фильтрации

### Многоязычность
- Multilingual поля: name, description
- Функция `safeJsonParse()` для безопасной обработки JSON
- Fallback на другой язык при отсутствии перевода

---

## 5. Страница отеля (hotel-template.html)

### Назначение
Детальная информация об отеле с галереей и удобствами.

### API Эндпоинты
- `GET /api/hotels/{hotelId}` - получение деталей отеля

### Ключевые особенности
1. **Header**
   - Название отеля
   - Звёзды (1-5)
   - Рейтинг (скрыт по запросу пользователя)
   - Категория (бейдж)
   - Бренд отеля

2. **Галерея**
   - Сетка 2x2 или 4 колонки
   - Lightbox для полноэкранного просмотра
   - Навигация между фото

3. **Описание отеля**
   - Multilingual текст
   - Расположение (country, city, address)

4. **Info Strip**
   - Тип питания (breakfast, half-board, full-board, all-inclusive)
   - Категория отеля

5. **Amenities Section**
   - Иконки для каждого удобства
   - Сетка 4 колонки
   - Font Awesome иконки

### Специфика работы
- URL параметр: `?hotel={hotelId}`
- Sticky header для удобства навигации
- Нет рейтинга (удалён по запросу)

---

## 6. Тургиды (tour-guides.html)

### Назначение
Каталог профессиональных гидов с возможностью найма.

### API Эндпоинты
- `GET /api/guides` - получение всех активных гидов
- `GET /api/guides/{guideId}` - детали гида
- `POST /api/guides/{guideId}/hire` - найм гида
- `GET /api/guides/{guideId}/availability` - проверка доступности

### Ключевые особенности
1. **Hero Section**
   - Заголовок и подзаголовок
   - 3 преимущества (лицензированные, 1000+ клиентов, многоязычность)

2. **Карточки гидов**
   - Фото гида (rounded avatar)
   - Имя и специализация
   - Опыт работы (badge)
   - Языки
   - Навыки (skill tags)
   - Рейтинг (звёзды)
   - Кнопка "Нанять гида"

3. **Modal найма гида**
   - Календарь выбора дат
   - Расчёт стоимости (цена за день × количество дней)
   - Форма контактных данных
   - Подтверждение и отправка

4. **Календарь**
   - Навигация по месяцам
   - Выбор множественных дат
   - Цветовая индикация: доступно (зелёный), занято (красный), выбрано (синий)

### Специфика работы
- Empty state: "Скоро здесь появятся наши тургиды"
- Loading shimmer для карточек
- Автоматический расчёт итоговой суммы

---

## 7. Визовая поддержка (visa-support.html)

### Назначение
Информация о визовых требованиях для въезда в Таджикистан.

### API Эндпоинты
- Нет (статическая информация)

### Ключевые особенности
1. **3 вида виз**
   - Безвизовый режим
   - Электронная виза
   - Стандартная виза

2. **Раскрывающиеся секции**
   - Accordion для каждого типа визы
   - Списки стран с условиями
   - Ссылки на официальные ресурсы

3. **Информационные карточки**
   - Gradient background
   - Нумерация типов виз
   - Border-left цветовая индикация

### Контент
- **Безвизовый режим**: 71 страна с условиями (дипломатический, служебный, все виды)
- **Электронная виза**: ссылка на https://www.evisa.tj (45 дней, однократная)
- **Упрощенная виза**: система https://www.visa.gov.tj

---

## 8. Трансфер (transfer.html)

### Назначение
Заказ трансфера с указанием деталей маршрута.

### API Эндпоинты
- `POST /api/transfer/request` - создание заявки на трансфер

### Ключевые особенности
1. **Форма заказа**
   - Контактные данные (ФИО, email, телефон)
   - Место приёма (адрес/отель/аэропорт)
   - Место высадки
   - Дата и время
   - Количество пассажиров
   - Тип транспорта (седан, SUV, микроавтобус, автобус)
   - Дополнительные пожелания

2. **Типы транспорта**
   - Седан (1-4 пассажира)
   - Внедорожник (1-5 пассажиров)
   - Микроавтобус (6-12 пассажиров)
   - Автобус (13+ пассажиров)

3. **Валидация**
   - Обязательные поля: ФИО, место приёма, место высадки, дата, время
   - Минимальная дата: сегодня
   - Email или телефон (хотя бы один)

4. **Уведомления**
   - Success: зелёный бейдж с галочкой
   - Error: красный бейдж с крестиком
   - Loading состояние кнопки

### Специфика работы
- Асинхронная отправка через fetch
- Автоматическая установка минимальной даты
- Disabled состояние кнопки во время отправки

---

## 9. Бронирование: Шаг 1 - Выбор отеля (booking-step1.html)

### Назначение
Первый шаг booking flow: выбор отеля и номеров.

### API Эндпоинты
- `POST /api/booking/start` - создание нового бронирования
- `GET /api/booking/tour/{tourId}/hotels` - получение отелей для тура
- `POST /api/booking/{bookingId}/hotel` - сохранение выбранного отеля и номеров

### URL Параметры
- `tourId` - ID тура
- `date` - дата тура
- `tourists` - количество туристов

### Ключевые особенности
1. **Progress Indicator**
   - 3 шага: Выбор отеля (активен), Данные туриста, Оплата
   - Визуальная индикация текущего шага

2. **Список отелей**
   - Карточки с фото, названием, звёздами
   - Удобства (amenities)
   - Категории номеров с ценами
   - Типы питания с ценами

3. **Селекторы номеров**
   - Кнопки +/- для выбора количества
   - Название номера, вместимость, цена за сутки
   - Автоматический расчёт общей стоимости

4. **Селекторы питания**
   - Выбор типа питания для всей группы
   - Breakfast, Half-board, Full-board, All-inclusive
   - Цена за человека за сутки

5. **Правая панель - Tour Details**
   - Название тура
   - Дата, длительность, количество туристов
   - Выбранный отель
   - Номера и питание
   - Расчёт стоимости:
     - Цена тура
     - Стоимость номеров (цена × кол-во × дни)
     - Стоимость питания (цена × туристы × дни)
     - **Итоговая сумма**

6. **Валидация**
   - Проверка общей вместимости номеров ≥ количество туристов
   - Блокировка кнопки "Продолжить" при невалидных данных
   - Подсказки пользователю

7. **Currency Conversion**
   - Отображение цен в TJS и выбранной валюте
   - Real-time конвертация через `/api/exchange-rates`
   - Формат: "1500 TJS (150 USD)"

### Специфика работы
- Создание `bookingId` на бэкенде
- Сохранение состояния в localStorage
- Автоматический переход на booking-step2.html при успехе

---

## 10. Бронирование: Шаг 2 - Данные туриста (booking-step2.html)

### Назначение
Второй шаг: сбор информации о контактном лице и туристах.

### API Эндпоинты
- `GET /api/booking/{bookingId}` - получение данных бронирования
- `PUT /api/booking/{bookingId}/tourists` - сохранение данных туристов

### URL Параметры
- `bookingId` - ID бронирования

### Ключевые особенности
1. **Progress Indicator**
   - Шаг 1: Выбор отеля (completed ✓)
   - **Шаг 2: Данные туриста (активен)**
   - Шаг 3: Оплата

2. **Форма контактного лица**
   - ФИО
   - Телефон
   - Email

3. **Динамический список туристов**
   - Автоматическое создание карточек по количеству туристов
   - Кнопка "+ Добавить туриста"
   - Для каждого туриста:
     - ФИО
     - Дата рождения
     - Гражданство
     - Номер паспорта
     - Срок действия паспорта
   - Кнопка удаления туриста

4. **Особые пожелания**
   - Textarea для дополнительных требований

5. **Согласия**
   - Checkbox: Принимаю условия оферты
   - Checkbox: Ознакомлен с правилами оплаты
   - Обязательные для продолжения

6. **Правая панель**
   - Детали тура
   - Выбранный отель
   - Номера и питание
   - Расчёт стоимости (readonly)

7. **Навигация**
   - Кнопка "Назад" → booking-step1.html
   - Кнопка "Подтвердить и перейти к оплате" → booking-step3.html

### Валидация
- Обязательные поля контактного лица
- Минимум 1 турист
- Оба checkbox должны быть отмечены

### Специфика работы
- Загрузка данных из localStorage + API
- Обновление bookingState в localStorage
- Автоматический переход на booking-step3.html

---

## 11. Бронирование: Шаг 3 - Оплата (booking-step3.html)

### Назначение
Финальный шаг: выбор способа оплаты и подтверждение.

### API Эндпоинты
- `GET /api/booking/{bookingId}` - получение данных для ваучера
- `POST /api/booking/{bookingId}/payment` - инициация платежа
- `POST /api/payment/payler` - оплата через Payler
- `POST /api/payment/alifpay` - оплата через AlifPay
- `POST /api/payment/binance` - оплата криптовалютой
- `POST /api/payment/korti-milli` - оплата через Корти Милли

### URL Параметры
- `bookingId` - ID бронирования

### Ключевые особенности
1. **Progress Indicator**
   - Шаг 1: completed ✓
   - Шаг 2: completed ✓
   - **Шаг 3: Оплата (активен)**

2. **Способы оплаты**
   - **Payler** (VISA/MasterCard)
   - **AlifPay** (локальная система Таджикистана)
   - **Binance** (криптовалюта)
   - **Корти Милли** (национальная платёжная система)

3. **Карточки способов оплаты**
   - Иконка платёжной системы
   - Название и описание
   - Иконки поддерживаемых карт
   - Hover эффект
   - Selected state (border + shadow)

4. **Booking Voucher (Ваучер)**
   - **Company Header**: логотип + название
   - **Статус**: ПОДТВЕРЖДЁН (зелёный бейдж)
   - **Дата тура**
   - **Название тура и тип**
   - **Контактное лицо**
   - **Участники тура**: список с индексами
   - **Язык тура**
   - **Включено**: список услуг с галочками
   - **Особые требования**
   - **Booking Reference**: BT-{id}{year}
   - **Детали отеля**: название, адрес, звёзды
   - **Категории номеров**: список с количеством
   - **Тип питания**
   - **Breakdown стоимости**:
     - Цена тура
     - Стоимость номеров
     - Стоимость питания
     - **Итого: {amount} TJS**

5. **Security Info**
   - Иконка щита
   - "Ваши данные защищены SSL-шифрованием"

6. **Payment Processing Modal**
   - Loading: spinner + "Обработка платежа"
   - Success: галочка + "Оплата успешна"
   - Error: крестик + "Ошибка оплаты"

7. **Навигация**
   - "Назад" → booking-step2.html
   - "Оплатить" (disabled до выбора способа оплаты)

### Специфика работы
- При успехе: редирект на payment-success.html
- При ошибке: показ modal с возможностью повтора
- Создание Order на бэкенде после успешной оплаты

---

## 12. Успешная оплата (payment-success.html)

### Назначение
Подтверждение успешного завершения платежа.

### API Эндпоинты
- `GET /api/orders/number/{orderNumber}` - получение деталей заказа
- `GET /api/orders/{orderNumber}/receipt` - скачивание чека

### URL Параметры
- `order` или `orderNumber` - номер заказа

### Ключевые особенности
1. **Success Animation**
   - Зелёная иконка с галочкой
   - Pulse анимация

2. **Success Message**
   - "Оплата прошла успешно!"
   - "Ваше бронирование подтверждено"
   - "На email отправлено подтверждение"

3. **Order Details**
   - Номер заказа
   - Название тура
   - Сумма платежа
   - Способ оплаты

4. **Action Buttons**
   - "Скачать чек" → PDF receipt
   - "Вернуться на главную" → index.html
   - "Мои заказы" → admin-dashboard.html#orders

5. **Additional Info**
   - Email с деталями бронирования
   - Телефон поддержки

### Специфика работы
- Загрузка данных из URL параметров или localStorage
- Автоматическая очистка localStorage через 5 минут
- Loading modal при загрузке

---

## Полный Booking Flow с деталями

### Этап 1: Выбор тура
**Страницы**: index.html, tours.html, tour-template.html

1. Пользователь просматривает туры на главной или в каталоге
2. Выбирает интересующий тур
3. Переход на tour-template.html?tour={tourId}
4. Просмотр деталей тура, галереи, программы
5. Выбор даты тура в календаре (правая панель)
6. Выбор количества туристов
7. Просмотр автоматического расчёта стоимости
8. Клик "Забронировать сейчас"

**Переход**: → booking-step1.html?tourId={id}&date={date}&tourists={count}

---

### Этап 2: Выбор отеля и номеров
**Страница**: booking-step1.html

**Backend:**
```
POST /api/booking/start
Body: { tourId, tourDate, numberOfTourists }
Response: { bookingId, tour, totalPrice }
```

**Frontend:**
1. API создаёт draft booking с статусом "draft"
2. Загружаются отели для выбранного тура: `GET /api/booking/tour/{tourId}/hotels`
3. Пользователь выбирает отель
4. Выбирает категории номеров (Стандарт, Люкс и т.д.) с помощью +/- кнопок
5. Выбирает тип питания (Breakfast, Half-board, Full-board, All-inclusive)
6. **Валидация вместимости**: сумма мест в номерах ≥ количество туристов
7. Правая панель показывает:
   - Цена тура: {priceType === 'за группу' ? price : price × tourists}
   - Стоимость номеров: Σ(roomPrice × quantity × tourDuration)
   - Стоимость питания: mealPrice × tourists × tourDuration
   - **Итого**: сумма всех компонентов
8. Конвертация в выбранную валюту (если не TJS)
9. Клик "Продолжить"

**Сохранение:**
```
POST /api/booking/{bookingId}/hotel
Body: {
  hotelId,
  roomSelection: { "standard": 2, "deluxe": 1 },
  mealSelection: { "breakfast": 50 }
}
Response: { success: true }
```

**Переход**: → booking-step2.html?bookingId={bookingId}

---

### Этап 3: Данные туристов
**Страница**: booking-step2.html

**Backend:**
```
GET /api/booking/{bookingId}
Response: {
  bookingId,
  tour,
  hotel,
  roomSelection,
  mealSelection,
  totalPrice,
  ...
}
```

**Frontend:**
1. Загрузка данных бронирования из API + localStorage
2. Отображение деталей в правой панели (readonly)
3. Форма контактного лица:
   - ФИО (обязательно)
   - Телефон (обязательно)
   - Email (обязательно)
4. Динамические карточки туристов (по количеству из шага 1):
   - ФИО
   - Дата рождения
   - Гражданство
   - Номер паспорта
   - Срок действия паспорта
   - Кнопка удаления
5. Кнопка "+ Добавить туриста"
6. Textarea "Особые пожелания"
7. **Обязательные checkbox**:
   - Принимаю условия оферты
   - Ознакомлен с правилами оплаты
8. Валидация всех полей
9. Клик "Подтвердить и перейти к оплате"

**Сохранение:**
```
PUT /api/booking/{bookingId}/tourists
Body: {
  contactName,
  contactPhone,
  contactEmail,
  tourists: [
    { fullName, dateOfBirth, citizenship, passportNumber, passportExpiry },
    ...
  ],
  specialRequests
}
Response: { success: true }
```

**Переход**: → booking-step3.html?bookingId={bookingId}

---

### Этап 4: Оплата
**Страница**: booking-step3.html

**Backend:**
```
GET /api/booking/{bookingId}
Response: {
  // Полные данные для отображения ваучера
  tour, hotel, tourists, roomSelection, mealSelection, totalPrice, ...
}
```

**Frontend:**
1. Загрузка данных бронирования
2. Генерация **Booking Voucher**:
   - Company header с логотипом
   - Booking reference: BT-{id}{year}
   - Статус: ПОДТВЕРЖДЁН
   - Детали тура и туристов
   - Детали отеля и номеров
   - Breakdown стоимости
3. Отображение способов оплаты:
   - Payler (VISA/MasterCard)
   - AlifPay
   - Binance (криптовалюта)
   - Корти Милли
4. Выбор способа оплаты (клик на карточку)
5. Активация кнопки "Оплатить"
6. Клик "Оплатить"

**Инициация платежа:**
```
POST /api/booking/{bookingId}/payment
Body: {
  paymentMethod: "payler" | "alifpay" | "binance" | "korti-milli"
}
Response: {
  paymentUrl: "https://payment-gateway.com/pay?id=xxx",
  orderId
}
```

7. Редирект на платёжный шлюз
8. Пользователь вводит данные карты
9. Callback от платёжной системы → backend
10. Backend обновляет статус:
    - Booking: draft → confirmed
    - Order: создаётся новый Order с status: "confirmed"
11. Редирект на payment-success.html?order={orderNumber}

---

### Этап 5: Подтверждение
**Страница**: payment-success.html

**Backend:**
```
GET /api/orders/number/{orderNumber}
Response: {
  orderNumber,
  tour,
  totalAmount,
  paymentMethod,
  ...
}
```

**Frontend:**
1. Отображение success иконки с анимацией
2. Сообщение "Оплата прошла успешно!"
3. Детали заказа:
   - Номер заказа
   - Название тура
   - Сумма платежа
   - Способ оплаты
4. Action buttons:
   - Скачать чек (PDF)
   - Вернуться на главную
   - Мои заказы
5. Информация о email подтверждении
6. Автоматическая очистка localStorage через 5 минут

**Email уведомление:**
- Отправляется автоматически после успешной оплаты
- Содержит: ваучер, детали тура, контакты

---

## Технические детали по страницам

### Система навигации
**Используется на всех страницах через layout-loader.js**

**Header структура:**
- Логотип слева
- Главное меню:
  - Главная
  - Туры (dropdown с подменю)
    - По странам (Таджикистан, Узбекистан, Киргизстан, Казахстан, Туркменистан)
    - По категориям (9 типов туров)
  - Отели (dropdown)
  - Трансфер
  - Тургиды
  - Визовая поддержка
  - О компании (dropdown)
- Языковой селектор (Русский 🇷🇺, English 🇺🇸)
- Валютный селектор (TJS, USD, EUR, RUB, CNY)

**Footer структура:**
- 4 колонки:
  - О компании
  - Популярные направления
  - Контакты
  - Социальные сети
- Copyright

---

### Система валют

**Endpoint**: `GET /api/exchange-rates`
**Response**:
```json
{
  "success": true,
  "data": [
    { "currency": "TJS", "rate": 1, "symbol": "TJS", "name": "Сомони" },
    { "currency": "USD", "rate": 0.091, "symbol": "$", "name": "Доллар США" },
    { "currency": "EUR", "rate": 0.084, "symbol": "€", "name": "Евро" },
    { "currency": "RUB", "rate": 8.5, "symbol": "₽", "name": "Российский рубль" },
    { "currency": "CNY", "rate": 0.65, "symbol": "¥", "name": "Китайский юань" }
  ]
}
```

**Использование:**
1. Загрузка курсов при инициализации страницы
2. Хранение в `currencyState.rates`
3. Сохранение выбранной валюты в `localStorage.selectedCurrency`
4. Функция конвертации: `formatCurrencyWithEquivalent(amountTJS, showEquivalent)`
5. Формат отображения:
   - TJS только: "1500 TJS"
   - С конвертацией: "1500 TJS (150 USD)"

**Применение на страницах:**
- index.html: цены туров в карточках
- tour-template.html: цены компонентов, итоговая сумма
- booking-step1.html: цены номеров и питания, расчёт
- booking-step2.html: итоговая сумма (readonly)
- booking-step3.html: ваучер с итоговой суммой

---

### Многоязычность

**Система**: Централизованная через `/public/js/i18n.js`

**Структура переводов**:
```javascript
const translations = {
  ru: {
    "page.title": "Bunyod-Tour - Туры по Таджикистану",
    "btn.book_now": "Забронировать сейчас",
    ...
  },
  en: {
    "page.title": "Bunyod-Tour - Tours in Tajikistan",
    "btn.book_now": "Book Now",
    ...
  }
}
```

**Использование:**
1. HTML атрибут: `<h1 data-translate="page.title">Default Text</h1>`
2. JavaScript функция: `getTranslation("page.title")`
3. Multilingual JSON: `{ ru: "Название", en: "Name" }`
4. Утилита: `getLocalizedText(multilingualObject, currentLang)`
5. Безопасный парсинг: `safeJsonParse(jsonString, defaultValue)`

**События:**
- `languageChanged`: срабатывает при смене языка
- Все страницы подписываются на событие для обновления контента

---

### Обработка изображений

**Функция**: `getAbsoluteImageUrl(relativePath)`

**Логика:**
1. Проверка на абсолютный URL (http:// или https://)
2. Проверка на Replit прокси
3. Формирование правильного пути
4. Fallback на placeholder при ошибке

**Применение:**
- Все изображения туров
- Фото отелей
- Аватары гидов
- Слайды hero-баннера

---

## API Endpoints - Полный список

### Tours
- `GET /api/tours` - все туры
- `GET /api/tours/{id}` - детали тура
- `GET /api/tours/blocks` - туры по блокам
- `GET /api/tours/{id}/prices` - цены компонентов

### Hotels
- `GET /api/hotels` - все отели
- `GET /api/hotels/{id}` - детали отеля
- `GET /api/hotels?country={country}` - отели по стране
- `GET /api/hotels?category={category}` - отели по категории

### Guides
- `GET /api/guides` - все гиды
- `GET /api/guides/{id}` - детали гида
- `GET /api/guides/{id}/availability` - доступность гида
- `POST /api/guides/{id}/hire` - найм гида

### Booking
- `POST /api/booking/start` - начало бронирования
- `GET /api/booking/{id}` - данные бронирования
- `GET /api/booking/tour/{tourId}/hotels` - отели для тура
- `POST /api/booking/{id}/hotel` - сохранение отеля и номеров
- `PUT /api/booking/{id}/tourists` - сохранение данных туристов
- `POST /api/booking/{id}/payment` - инициация платежа

### Orders
- `GET /api/orders/number/{orderNumber}` - получение заказа по номеру
- `GET /api/orders/{orderNumber}/receipt` - скачивание чека

### Payment
- `POST /api/payment/payler` - оплата через Payler
- `POST /api/payment/alifpay` - оплата через AlifPay
- `POST /api/payment/binance` - оплата криптовалютой
- `POST /api/payment/korti-milli` - оплата через Корти Милли

### Transfer
- `POST /api/transfer/request` - заявка на трансфер

### Utilities
- `GET /api/exchange-rates` - курсы валют
- `GET /api/exchange-rates/map` - курсы в формате карты
- `GET /api/slides` - слайды для баннера
- `GET /api/countries` - список стран
- `GET /api/cities?country={country}` - города по стране

---

## Специфика работы каждой страницы

### index.html
- **Инициализация**: загрузка туров, слайдов, курсов валют
- **Hero Slider**: автоматическая смена каждые 5 секунд
- **Tour Blocks**: 6 блоков с горизонтальной прокруткой
- **Toggle Filters**: раскрывающаяся панель фильтров
- **Dynamic Currency**: обновление цен при смене валюты через `window.updateCurrency()`

### tours.html
- **Клиентская фильтрация**: все туры загружаются сразу, фильтрация на фронте
- **Modal деталей**: открытие inline без перехода на другую страницу
- **3 вкладки в modal**: Описание, Программа, Отели

### tour-template.html
- **URL routing**: tourId из параметра `?tour={id}`
- **Галерея**: главное фото + миниатюры, навигация стрелками
- **Tabs**: переключение между Описанием и Программой
- **Booking форма**: календарь + counter → redirect на booking-step1.html
- **Component pricing**: динамический расчёт с inline редактированием

### hotels-catalog.html
- **Фильтрация**: страна, категория, звёзды, поиск
- **Multilingual cards**: использование `safeJsonParse()` и `getLocalizedText()`
- **Счётчик**: "Показано X из Y отелей"

### hotel-template.html
- **URL routing**: hotelId из параметра `?hotel={id}`
- **Lightbox галерея**: полноэкранный просмотр фото
- **Amenities**: сетка иконок с Font Awesome

### tour-guides.html
- **Hero section**: статичный заголовок с преимуществами
- **Карточки гидов**: аватар, имя, опыт, языки, навыки, рейтинг
- **Modal найма**: календарь с выбором множественных дат
- **Расчёт**: цена за день × количество выбранных дней
- **Empty state**: "Скоро здесь появятся наши тургиды"

### visa-support.html
- **Статический контент**: нет API вызовов
- **Accordion секции**: раскрывающиеся блоки для каждого типа визы
- **Списки стран**: 71 страна для безвизового режима

### transfer.html
- **Форма заявки**: контакты, маршрут, дата/время, тип транспорта
- **Валидация**: обязательные поля + минимальная дата
- **Асинхронная отправка**: fetch к `/api/transfer/request`
- **Уведомления**: success/error states

### booking-step1.html
- **Создание booking**: `POST /api/booking/start`
- **Выбор отеля**: загрузка отелей для тура
- **Выбор номеров**: +/- кнопки для количества
- **Выбор питания**: радио-кнопки для типа
- **Валидация вместимости**: проверка достаточности мест
- **Расчёт**: автоматический пересчёт при изменении
- **Сохранение**: `POST /api/booking/{id}/hotel`
- **localStorage**: сохранение bookingState для следующих шагов

### booking-step2.html
- **Загрузка**: `GET /api/booking/{id}` + localStorage
- **Динамические карточки**: генерация по количеству туристов
- **Форма контактов**: ФИО, телефон, email
- **Форма туристов**: полные данные + паспорт
- **Checkbox согласий**: обязательные для продолжения
- **Сохранение**: `PUT /api/booking/{id}/tourists`
- **Навигация**: кнопки "Назад" и "Продолжить"

### booking-step3.html
- **Загрузка**: `GET /api/booking/{id}`
- **Генерация ваучера**: профессиональный формат с логотипом
- **Способы оплаты**: 4 карточки с выбором
- **Активация кнопки**: только после выбора способа
- **Инициация платежа**: `POST /api/booking/{id}/payment`
- **Редирект**: на платёжный шлюз
- **Callback**: обработка результата на бэкенде
- **Success**: редирект на payment-success.html

### payment-success.html
- **URL параметры**: orderNumber из `?order={number}`
- **Загрузка**: `GET /api/orders/number/{orderNumber}` или localStorage
- **Success анимация**: pulse эффект на иконке
- **Детали заказа**: номер, тур, сумма, способ оплаты
- **Скачивание чека**: `GET /api/orders/{orderNumber}/receipt`
- **Очистка**: localStorage через 5 минут

---

## Заключение

Платформа Bunyod-Tour представляет собой полноценную систему бронирования туров с 12 публичными страницами, охватывающими весь цикл от выбора тура до подтверждения оплаты. Система использует современные подходы:

✅ **Централизованная архитектура** (i18n, layout-loader, utils)
✅ **RESTful API** с чёткой структурой endpoints
✅ **3-шаговый booking flow** с сохранением состояния
✅ **Real-time конвертация валют** (5 валют)
✅ **Многоязычность** (русский, английский)
✅ **4 платёжные системы** (Payler, AlifPay, Binance, Корти Милли)
✅ **Responsive дизайн** для всех устройств
✅ **Профессиональные ваучеры** для подтверждения

Все страницы работают в связке, обеспечивая seamless пользовательский опыт от просмотра туров до получения подтверждения оплаты.

# Документация админ-панели Bunyod-Tour

## Обзор

Админ-панель представляет собой единый файл `frontend/admin-dashboard.html` размером более 15000 строк кода, который содержит **22 основных функциональных модуля** для управления всеми аспектами туристической платформы.

### Архитектура

- **Технологии**: Vanilla JavaScript, Tailwind CSS, Font Awesome
- **Стиль**: SPA (Single Page Application) - все модули загружаются в одном файле
- **Аутентификация**: Логин/пароль с JWT token (localStorage)
- **API**: RESTful API endpoints через fetch
- **Языки**: Многоязычность (русский, английский) через централизованную систему i18n.js

### Навигационная структура

Sidebar включает 22 раздела:
1. Dashboard (главная)
2. Tours (туры)
3. Categories (категории туров)
4. Price Calculator (калькулятор компонентов цен)
5. Banner Management (управление баннером/слайдами)
6. Bookings (заказы)
7. Hotels (отели)
8. Guides (тургиды)
9. Tour Agents (турагенты)
10. Drivers (водители)
11. Trips (поездки)
12. Transfers (трансферы)
13. Countries (страны)
14. Cities (города)
15. Customers (клиенты)
16. Reviews (отзывы)
17. News (новости)
18. Payments (платежи)
19. Exchange Rates (курсы валют)
20. CMS (управление контентом)
21. Translations (переводы)
22. Settings (настройки)

---

## Модуль 1: Dashboard (Главная панель)

### Основные элементы интерфейса

**Статистические карточки (4 блока):**
- Активных туров (с иконкой карты)
- Заказов за месяц (с иконкой пользователей)
- Доход за месяц (с иконкой доллара)
- Активных клиентов (с иконкой людей)

**Таблица последних заказов:**
- Колонки: № Заказа, Клиент, Тур, Дата, Сумма, Статус, Действия
- Кнопка "Просмотреть все заказы"

### Ключевые действия и API-запросы

**Чтение:**
- `GET /api/stats` - получение статистики для карточек (не реализовано, используются mock данные)
- `GET /api/bookings?limit=10` - получение последних 10 заказов для таблицы

### Структура данных

Данный модуль не имеет форм создания/редактирования - только отображение агрегированных данных.

---

## Модуль 2: Tours (Управление турами)

### Основные элементы интерфейса

**Заголовок раздела:**
- Кнопка "Создать новый тур" (справа)

**Таблица туров:**
- Колонки: ID, Название, Категория, Страна, Город, Длительность, Цена, Статус, Действия
- Действия: Редактировать (иконка карандаша), Скопировать ссылку для отзывов (иконка ссылки), Удалить (иконка корзины)

**Модальное окно создания/редактирования тура:**
- Огромная форма с 50+ полями
- Разделение на вкладки/секции

### Ключевые действия и API-запросы

**Создание тура:**
- `POST /api/tours`
- Body: FormData (multipart/form-data) или JSON в зависимости от наличия файлов

**Чтение туров:**
- `GET /api/tours?includeRaw=true` - получение всех туров со сырыми JSON данными

**Чтение одного тура:**
- `GET /api/tours/{tourId}?includeRaw=true` - получение деталей тура для редактирования

**Обновление тура:**
- `PUT /api/tours/{tourId}`
- Body: FormData или JSON

**Удаление тура:**
- `DELETE /api/tours/{tourId}`

### Структура данных (Форма Создания/Редактирования тура)

**КРИТИЧЕСКИ ВАЖНО**: Эта форма является ключевой связью между админкой и публичной частью сайта.

#### Основная информация

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Название тура (RU) | `tourTitleRu` | text | ✅ | Русское название | Отображается на index.html, tours.html, tour-template.html |
| Название тура (EN) | `tourTitleEn` | text | ✅ | Английское название | Используется при переключении языка |
| Описание (RU) | `tourDescRu` | textarea | ✅ | Русское описание | Вкладка "Описание тура" на tour-template.html |
| Описание (EN) | `tourDescEn` | textarea | ✅ | Английское описание | Вкладка "Tour Description" (EN) |

**Формат данных при сохранении:**
```javascript
{
  title: JSON.stringify({ ru: "Тур в Душанбе", en: "Tour to Dushanbe" }),
  description: JSON.stringify({ ru: "Описание...", en: "Description..." })
}
```

#### Классификация тура

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Формат тура | `tourType` | select | ✅ | Тип тура | Фильтр "Формат" на tours.html |
| Категория | `tourCategory` | select (legacy) | ⚠️ | Старое поле категории | Заменено системой множественного выбора |
| Категории (новая система) | `selectedCategories` | array | ✅ | Массив выбранных категорий | Фильтр "Тематика" на tours.html, tour-template.html |
| Блок тура | `tourBlockId` | select | ⬜ | Привязка к блоку на главной | Блоки туров на index.html (Популярные, Рекомендованные и т.д.) |

**Доступные форматы тура:**
- `group` - Групповой
- `individual` - Индивидуальный
- `vip` - VIP
- `family` - Семейный

**Система категорий:**
- Множественный выбор через `selectedCategories` массив
- Интерфейс: кнопка "+ Добавить категорию" → выпадающий список → список выбранных с кнопками удаления
- Сохраняется как `categoryId` (первая выбранная категория) + дополнительные в отдельном массиве

#### Местоположение

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Страна (legacy) | `tourCountry` | select | ⚠️ | Старое поле страны | Заменено системой множественного выбора |
| Страны (новая система) | `selectedCountries` | array | ✅ | Массив выбранных стран | Фильтр "Направление" на tours.html, карточки туров |
| Город (legacy) | `tourCity` | select | ⚠️ | Старое поле города | Заменено системой множественного выбора |
| Города (новая система) | `selectedCities` | array | ✅ | Массив выбранных городов | Детали тура, фильтр городов |
| Информация о месте встречи | `tourPickupInfo` | textarea | ⬜ | Место встречи с группой | Info strip на tour-template.html |

**Система стран и городов:**
- Интерфейс множественного выбора
- Страны загружаются из `GET /api/countries`
- Города загружаются динамически: `GET /api/cities?countryIds={ids}`
- При выборе стран обновляется список доступных городов

#### Параметры тура

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Длительность (дней) | `tourDurationDays` | number | ✅ | Количество дней | "X дней" на карточках туров, info strip |
| Цена базовая | `tourPrice` | number | ✅ | Базовая цена в TJS | Карточки туров, booking flow |
| Тип цены | `tourPriceType` | select | ✅ | За человека/за группу | Форматирование цены на tour-template.html |
| Минимум туристов | `tourMinPeople` | number | ⬜ | Минимальное кол-во | Валидация в booking flow |
| Максимум туристов | `tourMaxPeople` | number | ⬜ | Максимальное кол-во | Валидация в booking flow |

**Доступные типы цен:**
- `за человека` - цена умножается на количество туристов
- `за группу` - фиксированная цена для группы

#### Component-based Pricing (Компонентное ценообразование)

| Элемент | ID/Класс | Тип | Описание | Связь с публичной частью |
|---------|----------|-----|----------|-------------------------|
| Список компонентов | `tourPricingComponentsDisplay` | container | Отображение выбранных компонентов | Breakdown цены на tour-template.html |
| Чекбоксы компонентов | `input[name="pricingComponent"]` | checkbox | Выбор компонентов для включения | Автоматический расчёт на tour-template.html |
| Цены компонентов | `tour_price_{componentId}` | number | Индивидуальные цены | Inline редактирование цен |
| Количество | `tour_quantity_{componentId}` | number | Количество единиц | Например: 3 гида, 2 автобуса |

**Доступные компоненты (загружаются из `/api/pricing-components`):**
- Гиды (guides)
- Транспорт (transport)
- Питание (meals)
- Проживание (accommodation)
- Билеты (tickets)
- Другие услуги (other)

**Формат сохранения:**
```javascript
pricingData: JSON.stringify([
  { key: "guide", name: "Гид", price: 200, unit: "за день", quantity: 1 },
  { key: "transport", name: "Автобус", price: 500, unit: "за тур", quantity: 1 }
])
```

#### Услуги и включения

| Поле | ID элемента | Тип | Описание | Связь с публичной частью |
|------|-------------|-----|------------|-------------------------|
| Включенные услуги | `input[name="tourServices"]` | checkbox group | Что входит в тур | Секция "Включено" на tour-template.html, иконки галочек |
| Добавить новую услугу | `newTourService` + `addNewTourService()` | text + button | Кастомная услуга | Динамическое добавление |
| Исключённые услуги | `input[name="tourExcludedServices"]` | checkbox group | Что НЕ входит в тур | Секция "Не включено" на tour-template.html |
| Добавить исключение | `newExcludedService` + `addNewExcludedService()` | text + button | Кастомное исключение | Динамическое добавление |

**Стандартные услуги (hardcoded):**
- Трансфер из аэропорта
- Профессиональный гид
- Входные билеты
- Все виды транспорта
- 3-разовое питание
- Проживание в отеле
- Страховка
- Сувениры

#### Программа тура (Itinerary)

**Многодневная программа:**
- Интерфейс: вкладки для каждого дня (Day 1, Day 2, ...)
- Каждый день содержит массив активностей

| Элемент | Структура | Описание | Связь с публичной частью |
|---------|-----------|----------|-------------------------|
| День тура | `window.tourDaysItinerary[dayNumber]` | Массив активностей | Timeline вкладка "Программа тура" на tour-template.html |
| Время | `time` | string (HH:MM) | Время начала активности |
| Активность (RU) | `activity.ru` | string | Описание на русском |
| Активность (EN) | `activity.en` | string | Описание на английском |

**Интерфейс управления:**
- Кнопка "+ Добавить день" - создаёт новую вкладку
- Для каждого дня: кнопка "+ Добавить активность"
- Каждая активность: поле времени + textarea RU + textarea EN + кнопка удаления

**Формат сохранения:**
```javascript
itinerary: JSON.stringify({
  "1": [
    { time: "09:00", activity: { ru: "Встреча в отеле", en: "Hotel pickup" } },
    { time: "10:00", activity: { ru: "Экскурсия", en: "Excursion" } }
  ],
  "2": [
    { time: "08:00", activity: { ru: "Завтрак", en: "Breakfast" } }
  ]
})
```

#### Языки тура

| Элемент | ID | Тип | Описание | Связь с публичной частью |
|---------|-----|-----|----------|-------------------------|
| Доступные языки | `availableLanguages` | select | Выбор языка для добавления | Info strip "Языки тура" на tour-template.html |
| Выбранные языки | `selectedLanguages` + `tourLanguages` | array + hidden | Массив выбранных языков | Отображается с флагами |
| Контейнер | `selectedLanguages` | div | Отображение выбранных | Список с кнопками удаления |

**Доступные языки:**
- Русский
- Английский
- Таджикский
- Фарси
- Немецкий
- Китайский

#### Доступные месяцы

| Элемент | ID/Name | Тип | Описание | Связь с публичной частью |
|---------|---------|-----|----------|-------------------------|
| Месяцы года | `input[name="tourMonths"]` | checkbox group | Когда проводится тур | Календарь на tour-template.html (выделение доступных дат) |

**12 чекбоксов:**
- Январь, Февраль, Март, Апрель, Май, Июнь, Июль, Август, Сентябрь, Октябрь, Ноябрь, Декабрь

**Формат сохранения:**
```javascript
availableMonths: JSON.stringify(["january", "february", "march"])
```

#### Отели тура

| Элемент | ID | Тип | Описание | Связь с публичной частью |
|---------|-----|-----|----------|-------------------------|
| Чекбоксы отелей | `input[name="tourHotels"]` | checkbox group | Выбор отелей | Вкладка "Отели" на tours.html modal, выбор отеля в booking-step1.html |

**Динамическая загрузка:**
- Функция `loadHotelsForCheckboxes()`
- API: `GET /api/hotels`
- Каждый чекбокс содержит: название отеля + звёзды + категория

#### Гиды тура

| Элемент | ID | Тип | Описание | Связь с публичной частью |
|---------|-----|-----|----------|-------------------------|
| Чекбоксы гидов | `input[name="tourGuides"]` | checkbox group | Выбор гидов | Назначение гида (future feature на tour-template.html) |

**Динамическая загрузка:**
- Функция `loadGuidesForCheckboxes()`
- API: `GET /api/guides`
- Каждый чекбокс содержит: имя гида + языки + опыт

#### Изображения

| Элемент | ID | Тип | Описание | Связь с публичной частью |
|---------|-----|-----|----------|-------------------------|
| Загрузка изображений | `tour-uploader-container` | ObjectUploader | Множественная загрузка через Object Storage | Галерея на tour-template.html, главное фото на карточках |
| URL изображений | `window.tourImageURLs` | array | Массив путей к изображениям | `images` field в БД |

**ObjectUploader настройки:**
- Максимум 15 файлов
- Максимум 10MB на файл
- Поддержка drag & drop
- Автоматическая нормализация путей через `/api/images` (PUT)

#### Дополнительные поля

| Поле | ID элемента | Тип | Описание |
|------|-------------|-----|----------|
| ID тура (скрытое) | `tour-id` | hidden | Используется для определения режима редактирования |
| Статус активности | `tourActive` | checkbox | Активен ли тур для публикации |

### Связь полей админки с публичными страницами

**index.html (главная):**
- `title` (ru/en) → название тура в карточках блоков
- `images[0]` → главное изображение карточки
- `price` → цена с конвертацией валют
- `durationDays` → "X дней"
- `tourBlockId` → определяет в каком блоке показывать тур (Популярные, Рекомендованные и т.д.)

**tours.html (каталог):**
- `title` → название в карточках и modal
- `description` → описание во вкладке modal
- `itinerary` → программа во вкладке modal
- `country`, `city` → фильтры направления
- `tourType` → фильтр формата
- `categoryId` → фильтр тематики
- `durationDays` → фильтр длительности
- `availableMonths` → фильтр дат

**tour-template.html (страница тура):**
- `images[]` → галерея изображений
- `title` → заголовок H1
- `description` → вкладка "Описание тура"
- `itinerary` → вкладка "Программа тура" (timeline)
- `services` → секция "Включено" (зелёные галочки)
- `excludedServices` → секция "Не включено" (красные крестики)
- `durationDays` → info strip
- `languages` → info strip с флагами
- `pickupInfo` → info strip
- `pricingData` → расчёт стоимости в правой панели
- `priceType` → формат отображения цены
- `availableMonths` → календарь (подсветка доступных дат)

**booking-step1.html:**
- `hotels` (выбранные) → список отелей для выбора
- `price` + `pricingData` → расчёт стоимости

**booking-step2.html, booking-step3.html:**
- `title`, `durationDays`, `price` → детали в ваучере

### Специфика работы модуля Tours

**Двойное хранение данных (Legacy + New):**
- Старая система: single select для category, country, city
- Новая система: multiple select через `selectedCategories`, `selectedCountries`, `selectedCities`
- При сохранении: первое значение из массива сохраняется в legacy поля для обратной совместимости

**Многодневная программа:**
- Глобальный объект `window.tourDaysItinerary`
- Конвертация старой программы (массив) в новый формат (объект по дням)
- Функция `initializeDayProgram()` инициализирует интерфейс

**Компонентное ценообразование:**
- Загрузка компонентов из `/api/pricing-components`
- Автоматический расчёт итоговой цены при изменении
- Синхронизация с секцией "Включенные услуги"

**Изображения:**
- Использование Replit Object Storage через ObjectUploader
- Нормализация путей через `/api/images` PUT endpoint
- Хранение массива путей в `window.tourImageURLs`

---

## Модуль 3: Categories (Категории туров)

### Основные элементы интерфейса

**Заголовок раздела:**
- Кнопка "Создать категорию" (справа)

**Таблица категорий:**
- Колонки: ID, Название (RU), Название (EN), Slug, Иконка, Статус, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/categories`

**Чтение:**
- `GET /api/categories` - получение всех категорий

**Обновление:**
- `PUT /api/categories/{id}`

**Удаление:**
- `DELETE /api/categories/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Название (RU) | `categoryNameRu` | text | ✅ | Русское название | Фильтр "Тематика" на tours.html |
| Название (EN) | `categoryNameEn` | text | ✅ | Английское название | Фильтр при переключении языка |
| Slug | `categorySlug` | text | ✅ | URL-friendly идентификатор | Используется в URL фильтров |
| Иконка | `categoryIcon` | text | ⬜ | Font Awesome класс | Иконка рядом с названием категории |
| Активна | `categoryActive` | checkbox | ⬜ | Показывать ли категорию | Фильтрация активных категорий |

**Формат сохранения:**
```javascript
{
  name: JSON.stringify({ ru: "Горные туры", en: "Mountain Tours" }),
  slug: "mountain-tours",
  icon: "fa-mountain",
  isActive: true
}
```

**Предустановленные категории (15 штук):**
1. Горные туры
2. Озёрные туры
3. Исторические туры
4. Культурные туры
5. Экологические туры
6. Приключенческие туры
7. Гастрономические туры
8. Фототуры
9. Однодневные туры
10. Многодневные туры
11. Комбинированные туры по Центральной Азии
12. Религиозные туры
13. Образовательные туры
14. Семейные туры
15. VIP туры

---

## Модуль 4: Price Calculator (Калькулятор цен компонентов)

### Основные элементы интерфейса

**Заголовок:**
- "Управление компонентами цен туров"
- Кнопка "Добавить компонент" (справа)

**Таблица компонентов:**
- Колонки: Название, Ключ, Базовая цена, Единица измерения, Категория, Действия
- Действия: Редактировать, Удалить

**Модальное окно компонента:**
- Форма создания/редактирования pricing component

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/pricing-components`

**Чтение:**
- `GET /api/pricing-components`

**Обновление:**
- `PUT /api/pricing-components/{id}`

**Удаление:**
- `DELETE /api/pricing-components/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с модулем Tours |
|------|-------------|-----|--------------|----------|----------------------|
| Название компонента | `componentName` | text | ✅ | Название услуги | Отображается в списке компонентов при создании тура |
| Ключ | `componentKey` | text | ✅ | Уникальный идентификатор | Используется для группировки (guide, transport, meal) |
| Базовая цена (TJS) | `componentPrice` | number | ✅ | Цена по умолчанию | Предзаполнение при выборе компонента в туре |
| Единица измерения | `componentUnit` | select | ✅ | За день / За тур / За человека | Определяет логику расчёта |
| Категория | `componentCategory` | select | ✅ | Тип услуги | Группировка в интерфейсе |

**Доступные единицы измерения:**
- `per_day` - За день
- `per_tour` - За тур
- `per_person` - За человека
- `per_hour` - За час

**Доступные категории:**
- `guide` - Гиды
- `transport` - Транспорт
- `meal` - Питание
- `accommodation` - Проживание
- `ticket` - Билеты
- `insurance` - Страховка
- `equipment` - Оборудование
- `other` - Другое

**Формат сохранения:**
```javascript
{
  name: "Профессиональный гид",
  key: "professional_guide",
  price: 250.00,
  unit: "per_day",
  category: "guide"
}
```

**Связь с модулем Tours:**
- Все компоненты загружаются в форму тура через `loadTourPricingComponents()`
- Отображаются как чекбоксы с полями для цены и количества
- При выборе компонента автозаполняется базовая цена
- Администратор может изменить цену для конкретного тура (inline editing)

---

## Модуль 5: Banner Management (Управление баннером/слайдами)

### Основные элементы интерфейса

**Заголовок:**
- "Управление баннером главной страницы"
- Кнопка "Добавить слайд" (справа)

**Список текущих слайдов:**
- Карточки слайдов с превью изображения
- Название слайда (RU/EN)
- Кнопки: Редактировать, Удалить
- Drag & drop для изменения порядка (future feature)

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/slides`

**Чтение:**
- `GET /api/slides` - получение всех слайдов

**Обновление:**
- `PUT /api/slides/{id}`

**Удаление:**
- `DELETE /api/slides/{id}`

### Структура данных (Форма Создания/Редактирования слайда)

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Заголовок (RU) | `slideTitleRu` | text | ✅ | Основной текст слайда | Hero slider на index.html (большой текст) |
| Заголовок (EN) | `slideTitleEn` | text | ✅ | Английский заголовок | При переключении языка |
| Подзаголовок (RU) | `slideSubtitleRu` | text | ⬜ | Дополнительный текст | Подзаголовок слайда (маленький текст) |
| Подзаголовок (EN) | `slideSubtitleEn` | text | ⬜ | Английский подзаголовок | При переключении языка |
| Изображение | `slideImage` | file upload | ✅ | Фоновое изображение | Background image hero slider |
| Ссылка (URL) | `slideLink` | text | ⬜ | Куда ведёт слайд | Кнопка "Узнать больше" на слайдере |
| Текст кнопки (RU) | `slideButtonTextRu` | text | ⬜ | Текст CTA кнопки | Кнопка на слайде |
| Текст кнопки (EN) | `slideButtonTextEn` | text | ⬜ | Английский текст CTA | При переключении языка |
| Порядок | `slideOrder` | number | ✅ | Порядок отображения | Последовательность слайдов |
| Активен | `slideActive` | checkbox | ⬜ | Показывать ли слайд | Фильтрация активных слайдов |

**Формат сохранения:**
```javascript
{
  title: JSON.stringify({ ru: "Откройте Таджикистан", en: "Discover Tajikistan" }),
  subtitle: JSON.stringify({ ru: "Незабываемые туры", en: "Unforgettable tours" }),
  imageUrl: "/uploads/slide1.jpg",
  link: "/tours.html?category=mountain",
  buttonText: JSON.stringify({ ru: "Узнать больше", en: "Learn more" }),
  order: 1,
  isActive: true
}
```

**Связь с публичной частью:**
- Hero slider на index.html
- Автоматическая смена каждые 5 секунд
- Точки-индикаторы для навигации
- Gradient overlay для читаемости текста

---

## Модуль 6: Bookings (Управление заказами)

### Основные элементы интерфейса

**Вкладки фильтрации:**
- Все заказы
- Ожидают оплаты (pending)
- Подтверждённые (confirmed)
- Отменённые (cancelled)

**Таблица заказов:**
- Колонки: № Заказа, Клиент, Тур, Дата тура, Туристы, Отель, Сумма, Статус, Действия
- Действия: Просмотреть детали, Изменить статус, Удалить

**Модальное окно деталей заказа:**
- Информация о туре
- Контактное лицо
- Список туристов
- Выбранный отель и номера
- Тип питания
- Breakdown стоимости
- История статусов

### Ключевые действия и API-запросы

**Чтение:**
- `GET /api/bookings` - все заказы
- `GET /api/bookings?status={status}` - фильтрация по статусу
- `GET /api/bookings/{id}` - детали заказа

**Обновление статуса:**
- `PUT /api/bookings/{id}/status`
- Body: `{ status: "confirmed" | "cancelled" | "completed" }`

**Удаление:**
- `DELETE /api/bookings/{id}`

### Структура данных (Просмотр заказа)

**Заказ не имеет формы создания в админке** - заказы создаются только через публичный booking flow.

**Отображаемые данные:**

| Поле | Источник | Описание |
|------|----------|----------|
| Номер заказа | `orderNumber` | BT-{id}{year} |
| Тур | `tour.title` | Название тура |
| Дата тура | `tourDate` | Дата начала |
| Количество туристов | `numberOfTourists` | Число человек |
| Контактное лицо | `contactName`, `contactPhone`, `contactEmail` | Из booking-step2.html |
| Туристы | `tourists[]` | Массив туристов с паспортными данными |
| Отель | `hotel.name` | Выбранный отель |
| Номера | `roomSelection` | JSON объект: {"standard": 2, "deluxe": 1} |
| Питание | `mealSelection` | JSON объект: {"breakfast": 50} |
| Особые требования | `specialRequests` | Текст из формы |
| Стоимость тура | `tourPrice` | Цена тура |
| Стоимость номеров | расчётная | Сумма (цена × кол-во × дни) |
| Стоимость питания | расчётная | (цена × туристы × дни) |
| Итого | `totalPrice` | Общая сумма |
| Способ оплаты | `paymentMethod` | Payler, AlifPay, Binance, Корти Милли |
| Статус | `status` | draft, confirmed, cancelled, completed |

**Связь с публичным booking flow:**
1. booking-step1.html → выбор отеля и номеров → создаёт booking (status: draft)
2. booking-step2.html → данные туристов → обновляет booking
3. booking-step3.html → оплата → создаёт order (status: confirmed), обновляет booking

---

## Модуль 7: Hotels (Управление отелями)

### Основные элементы интерфейса

**Заголовок:**
- Кнопка "Добавить отель" (справа)

**Таблица отелей:**
- Колонки: ID, Название, Звёзды, Категория, Страна, Город, Статус, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/hotels`
- Body: JSON

**Чтение:**
- `GET /api/hotels`
- `GET /api/hotels?country={country}`
- `GET /api/hotels?category={category}`

**Обновление:**
- `PUT /api/hotels/{id}`
- Body: JSON

**Удаление:**
- `DELETE /api/hotels/{id}`

### Структура данных (Форма Создания/Редактирования отеля)

#### Основная информация

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Название (RU) | `hotelNameRu` | text | ✅ | Русское название | Название на hotels-catalog.html, hotel-template.html |
| Название (EN) | `hotelNameEn` | text | ✅ | Английское название | При переключении языка |
| Описание (RU) | `hotelDescRu` | textarea | ✅ | Описание отеля | Секция описания на hotel-template.html |
| Описание (EN) | `hotelDescEn` | textarea | ✅ | Английское описание | При переключении языка |

**Формат сохранения:**
```javascript
{
  name: JSON.stringify({ ru: "Отель Душанбе Серена", en: "Dushanbe Serena Hotel" }),
  description: JSON.stringify({ ru: "Роскошный отель...", en: "Luxury hotel..." })
}
```

#### Классификация

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Звёзды | `hotelStars` | select (1-5) | ✅ | Количество звёзд | Звёздочки на карточках и странице отеля |
| Категория | `hotelCategory` | select | ✅ | Класс отеля | Бейдж категории на hotel-template.html |
| Бренд | `hotelBrand` | select + custom | ⬜ | Сетевой бренд | Header отеля |

**Доступные категории:**
- `business` - Бизнес
- `economy` - Эконом
- `luxury` - Люкс
- `boutique` - Бутик

**Доступные бренды:**
- Serena Hotels
- Hyatt
- Radisson
- Hilton
- Marriott
- Independent
- `custom` - Другой (появляется поле ввода)

#### Местоположение

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Страна | `hotelCountry` | select | ✅ | ID страны | Фильтр стран на hotels-catalog.html |
| Город | `hotelCity` | select | ✅ | ID города | Адрес на hotel-template.html, фильтр городов |
| Адрес | `hotelAddress` | text | ✅ | Полный адрес | Отображается с иконкой на hotel-template.html |

**Динамическая загрузка:**
- Страны: `GET /api/countries`
- Города загружаются при выборе страны: `GET /api/cities?countryId={id}`

#### Категории номеров (с ценами)

**КРИТИЧЕСКИ ВАЖНО для booking-step1.html**

| Поле | Checkbox ID | Price ID | Тип | Описание | Связь с публичной частью |
|------|------------|---------|-----|----------|-------------------------|
| Одноместный (SGL) | `roomSGL` | `priceSGL` | checkbox + number | Номер на 1 человека | Селектор номеров в booking-step1.html |
| Двухместный (TWL) | `roomTWL` | `priceTWL` | checkbox + number | Номер с 2 кроватями | Селектор номеров в booking-step1.html |
| Двухспальный (DBL) | `roomDBL` | `priceDBL` | checkbox + number | Номер с двуспальной кроватью | Селектор номеров в booking-step1.html |

**Формат сохранения:**
```javascript
roomTypes: JSON.stringify({
  SGL: { name: "Одноместный", price: 300 },
  TWL: { name: "Двухместный", price: 400 },
  DBL: { name: "Двухспальный", price: 450 }
})
```

**Связь с booking flow:**
- booking-step1.html загружает отели: `GET /api/booking/tour/{tourId}/hotels`
- Для каждого отеля отображаются доступные категории номеров
- Пользователь выбирает количество каждого типа номера через +/- кнопки
- Цена автоматически рассчитывается: `roomPrice × quantity × tourDuration`

#### Типы питания (с ценами)

**КРИТИЧЕСКИ ВАЖНО для booking-step1.html**

| Поле | Checkbox ID | Price ID | Тип | Описание | Связь с публичной частью |
|------|------------|---------|-----|----------|-------------------------|
| Без питания (RO) | `mealRO` | `priceMealRO` | checkbox + number | Room Only | Селектор питания в booking-step1.html |
| Завтрак (BB) | `mealBB` | `priceMealBB` | checkbox + number | Bed & Breakfast | Селектор питания в booking-step1.html |
| Полупансион (HB) | `mealHB` | `priceMealHB` | checkbox + number | Half Board | Селектор питания в booking-step1.html |
| Полный пансион (FB) | `mealFB` | `priceMealFB` | checkbox + number | Full Board | Селектор питания в booking-step1.html |
| Всё включено (AI) | `mealAI` | `priceMealAI` | checkbox + number | All Inclusive | Селектор питания в booking-step1.html |

**Формат сохранения:**
```javascript
mealTypes: JSON.stringify({
  RO: { name: "Без питания", price: 0 },
  BB: { name: "Завтрак", price: 50 },
  HB: { name: "Полупансион", price: 100 },
  FB: { name: "Полный пансион", price: 150 },
  AI: { name: "Все включено", price: 250 }
})
```

**Связь с booking flow:**
- Пользователь выбирает ОДИН тип питания для всей группы
- Цена рассчитывается: `mealPrice × numberOfTourists × tourDuration`
- Отображается в breakdown стоимости в правой панели

#### Удобства (Amenities)

| Элемент | Name/Value | Тип | Описание | Связь с публичной частью |
|---------|-----------|-----|----------|-------------------------|
| WiFi | `wifi` | checkbox | Бесплатный WiFi | Иконки удобств на hotel-template.html |
| Бассейн | `pool` | checkbox | Бассейн | Иконка бассейна |
| Фитнес-центр | `gym` | checkbox | Тренажёрный зал | Иконка гантелей |
| Спа | `spa` | checkbox | СПА-центр | Иконка спа |
| Парковка | `parking` | checkbox | Бесплатная парковка | Иконка машины |
| Ресторан | `restaurant` | checkbox | Ресторан | Иконка ресторана |
| Бар | `bar` | checkbox | Бар | Иконка бокала |
| Room Service | `roomService` | checkbox | Обслуживание номеров | Иконка колокольчика |
| Кондиционер | `airConditioning` | checkbox | Кондиционер | Иконка снежинки |
| Конференц-зал | `conferenceRoom` | checkbox | Конференц-зал | Иконка доски |

**Формат сохранения:**
```javascript
amenities: JSON.stringify(["wifi", "pool", "gym", "restaurant", "parking"])
```

**Отображение на hotel-template.html:**
- Секция "Amenities" с иконками Font Awesome
- Сетка 4 колонки
- Каждое удобство: иконка + название

#### Изображения

| Элемент | ID | Тип | Описание | Связь с публичной частью |
|---------|-----|-----|----------|-------------------------|
| Загрузчик изображений | `hotel-uploader-container` | ObjectUploader | Множественная загрузка | Галерея на hotel-template.html, главное фото на карточках |
| URL изображений | `window.hotelImageURLs` | array | Массив путей | `images` field в БД |

**ObjectUploader настройки:**
- Максимум 10 файлов
- Максимум 10MB на файл
- Автоматическая нормализация через `/api/images` PUT

#### Дополнительные поля

| Поле | ID элемента | Тип | Описание |
|------|-------------|-----|----------|
| ID отеля (скрытое) | `hotel-id` | hidden | Режим редактирования |
| Активен | `hotelActive` | checkbox | Показывать ли отель |
| Legacy pension | `pension` | hidden | Устаревшее поле (теперь используется mealTypes) |

---

## Модуль 8: Guides (Управление гидами)

### Основные элементы интерфейса

**Заголовок:**
- Кнопка "Добавить гида" (справа)

**Таблица гидов:**
- Колонки: ID, Фото, Имя, Email, Телефон, Языки, Опыт, Статус, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/guide/profile`
- Body: FormData (multipart) - поддержка файлов

**Чтение:**
- `GET /api/guides`
- `GET /api/guide/profile/{id}`

**Обновление:**
- `PUT /api/guide/profile/{id}`
- Body: FormData

**Удаление:**
- `DELETE /api/guide/profile/{id}`

### Структура данных (Форма Создания/Редактирования гида)

#### Основная информация

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| ФИО (RU) | `guideFullNameRu` | text | ✅ | Полное имя на русском | Имя гида на tour-guides.html |
| ФИО (EN) | `guideFullNameEn` | text | ✅ | Полное имя на английском | При переключении языка |
| Email | `guideEmail` | email | ✅ | Email для связи | Контактные данные |
| Телефон | `guidePhone` | tel | ⬜ | Номер телефона | Контактные данные |
| Опыт работы (лет) | `guideExperience` | number | ⬜ | Количество лет | Badge на карточке гида |

**Формат сохранения:**
```javascript
{
  name: JSON.stringify({ ru: "Иван Петров", en: "Ivan Petrov" }),
  email: "ivan@example.com",
  phone: "+992 900 000 000",
  experience: 5
}
```

#### Местоположение

| Поле | ID элемента | Тип | Обязательное | Описание |
|------|-------------|-----|--------------|----------|
| Страна | `guideCountry` | select | ✅ | ID страны работы |
| Город | `guideCity` | select | ✅ | ID города работы |

**Связь:**
- Страны: `GET /api/countries`
- Города динамически: `GET /api/cities?countryId={id}`

#### Языки гида

| Элемент | ID | Тип | Описание | Связь с публичной частью |
|---------|-----|-----|----------|-------------------------|
| Доступные языки | `guideAvailableLanguages` | select | Выбор языка для добавления | Список языков на карточке гида на tour-guides.html |
| Выбранные языки | `selectedGuideLanguages` + `guideLanguagesHidden` | array + hidden | Массив выбранных | Отображается списком |

**Формат:**
```javascript
languages: "Русский, Английский, Таджикский"
```

#### Паспортные и регистрационные данные

| Поле | ID элемента | Тип | Обязательное | Описание |
|------|-------------|-----|--------------|----------|
| Серия и номер паспорта | `guidePassportSeries` | text | ⬜ | Паспортные данные |
| Прописка | `guideRegistration` | text | ⬜ | Адрес регистрации |
| Адрес проживания | `guideResidenceAddress` | text | ⬜ | Фактический адрес |

#### Авторизация (для входа гида)

| Поле | ID элемента | Тип | Обязательное | Описание |
|------|-------------|-----|--------------|----------|
| Логин | `guideLogin` | text | ⬜ | Username для входа в личный кабинет |
| Пароль | `guidePassword` | password | ⬜ | Пароль (хранится хешированный) |
| Статус | `guideIsActive` | select (true/false) | ✅ | Активен ли аккаунт |

#### Файлы

| Поле | ID элемента | Тип | Описание | Связь с публичной частью |
|------|-------------|-----|----------|-------------------------|
| Аватар | `guideAvatar` + `handleGuideAvatarUpload()` | file | Фотография гида | Аватар на tour-guides.html |
| Документы | `guideDocuments` + `handleGuideDocumentsUpload()` | file (multiple) | Лицензии, сертификаты | Для внутреннего использования |

**Поддерживаемые форматы:**
- Аватар: JPG, PNG (макс 5MB)
- Документы: PDF, DOC, DOCX, JPG, PNG (макс 10MB на файл)

**Предпросмотр:**
- Аватар: показывается превью изображения
- Документы: список файлов с иконками и размерами

#### Дополнительная информация

| Поле | ID элемента | Тип | Описание |
|------|-------------|-----|----------|
| Комментарии | `guideComments` | textarea | Дополнительная информация о гиде |

---

## Модуль 9: Tour Agents (Турагенты)

### Основные элементы интерфейса

**Заголовок:**
- "Управление турагентами"
- Кнопка "Добавить турагента" (справа)

**Таблица турагентов:**
- Колонки: ID, Название агентства, Контактное лицо, Email, Телефон, Город, Комиссия (%), Статус, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/tour-agents`

**Чтение:**
- `GET /api/tour-agents`

**Обновление:**
- `PUT /api/tour-agents/{id}`

**Удаление:**
- `DELETE /api/tour-agents/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| Название агентства | text | ✅ | Название компании |
| Контактное лицо | text | ✅ | ФИО представителя |
| Email | email | ✅ | Email для связи |
| Телефон | tel | ⬜ | Контактный телефон |
| Адрес | text | ⬜ | Физический адрес офиса |
| Город | text | ⬜ | Город работы |
| Комиссия (%) | number | ✅ | Процент комиссии с продаж |
| Логин | text | ⬜ | Username для входа |
| Пароль | password | ⬜ | Пароль (при создании) |
| Активен | checkbox | ⬜ | Статус аккаунта |

**Примечание:** Модуль турагентов используется для партнёрской программы - турагенты могут бронировать туры для своих клиентов с комиссией.

---

## Модуль 10: Drivers (Управление водителями)

### Основные элементы интерфейса

**Заголовок:**
- "Управление водителями"
- Кнопка "Добавить водителя" (справа)

**Таблица водителей:**
- Колонки: ID, Имя, Email, Телефон, Опыт, Категория прав, Марка авто, Цена/день, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/drivers`
- Body: FormData (поддержка файлов)

**Чтение:**
- `GET /api/drivers`

**Обновление:**
- `PUT /api/drivers/{id}`

**Удаление:**
- `DELETE /api/drivers/{id}`

### Структура данных (Форма Создания/Редактирования)

#### Личная информация

| Поле | Name | Тип | Обязательное | Описание |
|------|------|-----|--------------|----------|
| Имя | `name` | text | ✅ | Полное имя водителя |
| Email | `email` | email | ✅ | Email для связи |
| Телефон | `phone` | tel | ⬜ | Контактный телефон |
| Опыт (лет) | `experience` | number | ⬜ | Количество лет вождения |

#### Водительские права

| Поле | Name | Тип | Описание |
|------|------|-----|----------|
| Номер удостоверения | `licenseNumber` | text | Серия и номер прав |
| Категория прав | `licenseCategory` | select | B, C, D, BE, CE, DE |

**Доступные категории:**
- B - Легковые автомобили
- C - Грузовые автомобили
- D - Автобусы
- BE - Легковые с прицепом
- CE - Грузовые с прицепом
- DE - Автобусы с прицепом

#### Информация о транспорте

| Поле | Name | Тип | Описание |
|------|------|-----|----------|
| Марка автомобиля | `vehicleBrand` | text | Toyota, Mercedes, etc. |
| Год выпуска | `vehicleYear` | number | Год производства (1990-2025) |
| Типы транспорта | `vehicleTypes[]` | checkbox group | Множественный выбор |

**Доступные типы транспорта:**
- Седан (sedan)
- Внедорожник (suv)
- Микроавтобус (minibus)
- Автобус (bus)
- Грузовик (truck)

#### Цены

| Поле | Name | Тип | Описание |
|------|------|-----|----------|
| Цена за день (TJS) | `pricePerDay` | number | Стоимость аренды за день |
| Цена за час (TJS) | `pricePerHour` | number | Стоимость аренды за час |

#### Дополнительно

| Поле | Name | Тип | Описание |
|------|------|-----|----------|
| Языки | `languages` | text | Русский, Таджикский, Английский |
| Рабочие зоны | `workingAreas` | text | Душанбе, Худжанд, Куляб |
| Описание | `description` | textarea | Дополнительная информация |

#### Файлы

| Поле | Name | Тип | Описание |
|------|------|-----|----------|
| Аватар | `avatar` | file | Фотография водителя |
| Фото транспорта | `vehiclePhotos` | file (multiple) | Фото автомобиля |

---

## Модуль 11: Trips (Управление поездками)

### Основные элементы интерфейса

**Заголовок:**
- "Управление поездками"
- Кнопка "Создать поездку" (справа)

**Таблица поездок:**
- Колонки: ID, Тур, Дата, Водитель, Транспорт, Маршрут, Статус, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/trips`

**Чтение:**
- `GET /api/trips`

**Обновление:**
- `PUT /api/trips/{id}`

**Удаление:**
- `DELETE /api/trips/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| Тур | select | ✅ | Связанный тур |
| Дата поездки | date | ✅ | Дата начала |
| Водитель | select | ✅ | Назначенный водитель |
| Тип транспорта | select | ✅ | Седан, SUV, микроавтобус, автобус |
| Маршрут | textarea | ⬜ | Описание маршрута |
| Примечания | textarea | ⬜ | Дополнительная информация |
| Статус | select | ✅ | Запланирована, В процессе, Завершена |

---

## Модуль 12: Transfers (Управление трансферами)

### Основные элементы интерфейса

**Заголовок:**
- "Управление трансферами"
- Кнопка "Создать трансфер" (справа)

**Таблица трансферов:**
- Колонки: ID, Клиент, От, До, Дата, Время, Водитель, Стоимость, Статус, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/transfers`

**Чтение:**
- `GET /api/transfers`

**Обновление:**
- `PUT /api/transfers/{id}`

**Удаление:**
- `DELETE /api/transfers/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | Name | Тип | Обязательное | Описание |
|------|------|-----|--------------|----------|
| Клиент | `clientName` | text | ✅ | Имя клиента |
| Телефон клиента | `clientPhone` | tel | ⬜ | Контактный телефон |
| От (место подачи) | `pickupLocation` | text | ✅ | Адрес/отель/аэропорт |
| До (место назначения) | `dropoffLocation` | text | ✅ | Адрес назначения |
| Дата | `transferDate` | date | ✅ | Дата трансфера |
| Время | `transferTime` | time | ✅ | Время подачи |
| Водитель | `driverId` | select | ✅ | Выбор из списка водителей |
| Тип транспорта | `vehicleType` | select | ⬜ | Седан, внедорожник, микроавтобус, автобус, грузовик |
| Стоимость (TJS) | `cost` | number | ⬜ | Цена трансфера |
| Количество пассажиров | `passengerCount` | number | ⬜ | Число человек (1-50) |
| Примечания | `notes` | textarea | ⬜ | Дополнительная информация |

**Связь с публичной частью:**
- Заявки с transfer.html попадают в этот модуль
- Администратор назначает водителя и подтверждает трансфер

---

## Модуль 13: Countries (Управление странами)

### Основные элементы интерфейса

**Заголовок:**
- "Управление странами"
- Кнопка "Добавить страну" (справа)

**Сетка стран (карточки):**
- Название (RU, EN, TJ)
- Код страны
- Количество городов
- Статус
- Кнопки: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/countries`

**Чтение:**
- `GET /api/countries`

**Обновление:**
- `PUT /api/countries/{id}`

**Удаление:**
- `DELETE /api/countries/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | Тип | Обязательное | Описание | Связь с модулями |
|------|-----|--------------|----------|-----------------|
| Название (RU) | text | ✅ | Русское название | Фильтры туров, отелей, гидов |
| Название (EN) | text | ✅ | Английское название | При переключении языка |
| Название (TJ) | text | ✅ | Таджикское название | Локализация |
| Код | text | ✅ | ISO код (TJ, UZ, KG, KZ, TM) | Для API и фильтрации |
| Активна | checkbox | ⬜ | Показывать ли страну | Фильтр активных |

**Предустановленные страны Центральной Азии:**
1. Таджикистан (TJ)
2. Узбекистан (UZ)
3. Киргизстан (KG)
4. Казахстан (KZ)
5. Туркменистан (TM)

---

## Модуль 14: Cities (Управление городами)

### Основные элементы интерфейса

**Заголовок:**
- "Управление городами"
- Кнопка "Добавить город" (справа)

**Сетка городов (карточки):**
- Название (RU, EN, TJ)
- Страна
- Статус
- Кнопки: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/cities`

**Чтение:**
- `GET /api/cities`
- `GET /api/cities?countryId={id}` - города по стране

**Обновление:**
- `PUT /api/cities/{id}`

**Удаление:**
- `DELETE /api/cities/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | Тип | Обязательное | Описание | Связь с модулями |
|------|-----|--------------|----------|-----------------|
| Название (RU) | text | ✅ | Русское название | Фильтры туров, адреса отелей |
| Название (EN) | text | ✅ | Английское название | При переключении языка |
| Название (TJ) | text | ✅ | Таджикское название | Локализация |
| Страна | select | ✅ | ID страны | Связь с модулем Countries |
| Активен | checkbox | ⬜ | Показывать ли город | Фильтр активных |

**Связь с модулями:**
- Tours: множественный выбор городов
- Hotels: выбор города отеля
- Guides: город работы гида
- Фильтры на публичных страницах

---

## Модуль 15: Customers (Клиенты)

### Основные элементы интерфейса

**Таблица клиентов:**
- Колонки: ID, Имя, Email, Телефон, Количество заказов, Общая сумма, Дата регистрации, Действия
- Действия: Просмотреть историю заказов, Заблокировать

### Ключевые действия и API-запросы

**Чтение:**
- `GET /api/customers` - список всех клиентов
- `GET /api/customers/{id}` - детали клиента
- `GET /api/customers/{id}/bookings` - история заказов клиента

**Обновление:**
- `PUT /api/customers/{id}` - обновление данных
- `PUT /api/customers/{id}/block` - блокировка клиента

### Структура данных

**Клиенты создаются автоматически** при первом бронировании через публичный сайт.

**Отображаемые данные:**
- Контактная информация (из booking-step2.html)
- Статистика заказов
- История платежей
- Статус аккаунта

---

## Модуль 16: Reviews (Модерация отзывов)

### Основные элементы интерфейса

**Вкладки фильтрации:**
- Все отзывы
- На модерации (pending)
- Одобренные (approved)
- Отклонённые (rejected)

**Таблица отзывов:**
- Колонки: ID, Дата, Имя туриста, Тур, Рейтинг (звёзды), Отзыв, Фотографии, Статус, Действия
- Действия: Одобрить, Отклонить, Удалить

### Ключевые действия и API-запросы

**Чтение:**
- `GET /api/reviews` - все отзывы
- `GET /api/reviews?status={status}` - фильтрация по статусу

**Модерация:**
- `PUT /api/reviews/{id}/approve` - одобрить отзыв
- `PUT /api/reviews/{id}/reject` - отклонить отзыв

**Удаление:**
- `DELETE /api/reviews/{id}`

### Структура данных

**Отзывы создаются туристами** через специальную ссылку после завершения тура.

**Отображаемые данные:**

| Поле | Описание |
|------|----------|
| Имя туриста | Из формы отзыва |
| Тур | Связанный тур |
| Рейтинг | 1-5 звёзд |
| Текст отзыва | Комментарий туриста |
| Фотографии | Массив загруженных фото |
| Дата создания | Timestamp |
| Статус | pending, approved, rejected |

**Связь с публичной частью:**
- Одобренные отзывы отображаются на tour-template.html
- Рейтинг влияет на звёзды тура

---

## Модуль 17: News (Управление новостями)

### Основные элементы интерфейса

**Статистические карточки:**
- Всего новостей
- Опубликовано
- Черновики
- Просмотры

**Вкладки фильтрации:**
- Все новости
- Опубликованные (published)
- Черновики (draft)
- Рекомендуемые (featured)

**Таблица новостей:**
- Колонки: ID, Заголовок, Категория, Статус, Автор, Дата публикации, Просмотры, Действия
- Действия: Редактировать, Удалить

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/news`

**Чтение:**
- `GET /api/news`
- `GET /api/news?status={status}`

**Обновление:**
- `PUT /api/news/{id}`

**Удаление:**
- `DELETE /api/news/{id}`

### Структура данных (Форма Создания/Редактирования)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| Заголовок (RU) | text | ✅ | Русский заголовок |
| Заголовок (EN) | text | ✅ | Английский заголовок |
| Контент (RU) | textarea/editor | ✅ | Текст новости на русском |
| Контент (EN) | textarea/editor | ✅ | Текст новости на английском |
| Категория | select | ✅ | События, Новости компании, Туризм и т.д. |
| Главное изображение | file | ⬜ | Обложка новости |
| Статус | select | ✅ | draft, published |
| Рекомендуемая | checkbox | ⬜ | Featured новость |
| Автор | text | ⬜ | Имя автора |
| Дата публикации | date | ⬜ | Когда опубликовать |

---

## Модуль 18: Payments (Платежи)

### Основные элементы интерфейса

**Таблица платежей:**
- Колонки: ID, Заказ, Клиент, Сумма, Способ оплаты, Статус, Дата, Действия
- Действия: Просмотреть детали, Возврат (refund)

### Ключевые действия и API-запросы

**Чтение:**
- `GET /api/payments` - все платежи
- `GET /api/payments/{id}` - детали платежа
- `GET /api/payments/order/{orderNumber}` - платежи по заказу

**Возврат:**
- `POST /api/payments/{id}/refund` - инициация возврата

### Структура данных

**Платежи создаются автоматически** при успешной оплате в booking flow.

**Отображаемые данные:**

| Поле | Описание |
|------|----------|
| Transaction ID | Уникальный ID транзакции |
| Order Number | Связанный заказ |
| Amount | Сумма платежа |
| Currency | TJS (базовая валюта) |
| Payment Method | Payler, AlifPay, Binance, Корти Милли |
| Status | pending, completed, failed, refunded |
| Gateway Response | Ответ от платёжного шлюза |
| Created At | Timestamp |

**Поддерживаемые методы оплаты:**
1. **Payler** - Visa/MasterCard
2. **AlifPay** - локальная система Таджикистана
3. **Binance** - криптовалюта
4. **Корти Милли** - национальная платёжная система

---

## Модуль 19: Exchange Rates (Курсы валют)

### Основные элементы интерфейса

**Заголовок:**
- "Управление курсами валют"
- Кнопка "Добавить валюту" (справа)

**Таблица курсов:**
- Колонки: Валюта (код), Название, Символ, Курс (к TJS), Последнее обновление, Действия
- Действия: Редактировать, Удалить

**Калькулятор валют:**
- Поле ввода суммы
- Выбор целевой валюты
- Кнопка "Рассчитать"
- Результат конвертации

### Ключевые действия и API-запросы

**Создание:**
- `POST /api/exchange-rates`

**Чтение:**
- `GET /api/exchange-rates` - все курсы
- `GET /api/exchange-rates/map` - курсы в формате карты
- `GET /api/exchange-rates/convert?amount={amount}&targetCurrency={currency}` - конвертация

**Обновление:**
- `PUT /api/exchange-rates/{currency}`

**Удаление:**
- `DELETE /api/exchange-rates/{currency}`

### Структура данных (Форма Создания/Редактирования)

| Поле | ID элемента | Тип | Обязательное | Описание | Связь с публичной частью |
|------|-------------|-----|--------------|----------|-------------------------|
| Код валюты | `editCurrencyCode` | text (3 символа) | ✅ | ISO код (USD, EUR, RUB, CNY) | Header валютный селектор |
| Название | `editCurrencyName` | text | ✅ | Полное название | Tooltip в селекторе |
| Символ | `editCurrencySymbol` | text | ✅ | $ € ¥ ₽ | Отображение цен |
| Курс к TJS | `editCurrencyRate` | number | ✅ | Коэффициент конвертации | Расчёт цен на всех страницах |

**Базовая валюта:**
- TJS (Таджикский сомони) - rate = 1
- Нельзя удалить или изменить курс

**Формат сохранения:**
```javascript
{
  currency: "USD",
  name: "Доллар США",
  symbol: "$",
  rate: 0.091
}
```

**Связь с публичными страницами:**
- Header всех страниц: валютный селектор
- index.html: конвертация цен туров в карточках
- tour-template.html: конвертация в booking форме
- booking-step1.html, booking-step2.html, booking-step3.html: отображение в TJS и выбранной валюте

**Поддерживаемые валюты:**
1. TJS - Таджикский сомони (базовая)
2. USD - Доллар США
3. EUR - Евро
4. RUB - Российский рубль
5. CNY - Китайский юань

**Автоматическое обновление:**
- Курсы можно обновлять вручную через админку
- В будущем: интеграция с API курсов валют для автообновления

---

## Модуль 20: CMS (Управление контентом)

Модуль CMS разделён на **4 вкладки**:

### 20.1. Блоки контента (Content Blocks)

#### Основные элементы интерфейса

**Заголовок:**
- "Управление блоков контента"
- Кнопка "Создать блок контента" (справа)

**Таблица блоков:**
- Колонки: ID, Тип, Название (RU), Название (EN), Статус, Обновлено, Действия
- Действия: Редактировать, Удалить

#### API запросы

**Создание:**
- `POST /api/cms/content-blocks`

**Чтение:**
- `GET /api/cms/content-blocks`

**Обновление:**
- `PUT /api/cms/content-blocks/{id}`

**Удаление:**
- `DELETE /api/cms/content-blocks/{id}`

#### Структура данных

| Поле | ID элемента | Тип | Обязательное | Описание |
|------|-------------|-----|--------------|----------|
| Тип блока | `blockType` | select | ✅ | hero_banner, about_section, services_section, tours_section, testimonials, contact_info, footer_text, custom |
| Заголовок (RU) | `blockTitle_ru` | text | ⬜ | Русский заголовок |
| Заголовок (EN) | `blockTitle_en` | text | ⬜ | Английский заголовок |
| Заголовок (FA) | `blockTitle_fa` | text | ⬜ | Персидский |
| Заголовок (DE) | `blockTitle_de` | text | ⬜ | Немецкий |
| Заголовок (ZH) | `blockTitle_zh` | text | ⬜ | Китайский |
| Содержание (RU) | `blockContent_ru` | textarea | ⬜ | Текст на русском |
| Содержание (EN) | `blockContent_en` | textarea | ⬜ | Текст на английском |
| Содержание (FA) | `blockContent_fa` | textarea | ⬜ | Персидский |
| Содержание (DE) | `blockContent_de` | textarea | ⬜ | Немецкий |
| Содержание (ZH) | `blockContent_zh` | textarea | ⬜ | Китайский |
| Порядок | `blockOrder` | number | ⬜ | Порядок отображения |
| Активен | `blockActive` | checkbox | ⬜ | Статус блока |

**Поддержка 6 языков:**
- ru - Русский
- en - English
- tj - Тоҷикӣ (будущее)
- fa - فارسی (Farsi)
- de - Deutsch
- zh - 中文 (Chinese)

---

### 20.2. Настройки сайта (Site Settings)

#### Основные элементы интерфейса

**Форма настроек:**
- Название сайта (RU/EN)
- Описание сайта (RU/EN)
- Контактный email
- Контактный телефон
- Кнопка "Сохранить настройки"

#### API запросы

**Чтение:**
- `GET /api/cms/settings`

**Обновление:**
- `PUT /api/cms/settings`

#### Структура данных

| Поле | ID элемента | Тип | Описание |
|------|-------------|-----|----------|
| Название сайта (RU) | `siteTitle_ru` | text | Мета-тег title |
| Название сайта (EN) | `siteTitle_en` | text | Мета-тег title (EN) |
| Описание сайта (RU) | `siteDescription_ru` | textarea | Мета-тег description |
| Описание сайта (EN) | `siteDescription_en` | textarea | Мета-тег description (EN) |
| Email | `contactEmail` | email | Контактный email |
| Телефон | `contactPhone` | tel | Контактный телефон |

---

### 20.3. Страницы (CMS Pages)

#### Основные элементы интерфейса

**Заголовок:**
- "Управление страницами"
- Кнопка "Создать страницу" (справа)

**Таблица страниц:**
- Колонки: ID, Slug, Название (RU), Название (EN), Статус, Обновлено, Действия
- Действия: Редактировать, Удалить

#### API запросы

**Создание:**
- `POST /api/cms/pages`

**Чтение:**
- `GET /api/cms/pages`

**Обновление:**
- `PUT /api/cms/pages/{id}`

**Удаление:**
- `DELETE /api/cms/pages/{id}`

#### Структура данных

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| Slug | text | ✅ | URL страницы (about-us, contacts) |
| Название (RU) | text | ✅ | Заголовок страницы |
| Название (EN) | text | ✅ | Заголовок на английском |
| Контент (RU) | textarea/editor | ✅ | HTML контент |
| Контент (EN) | textarea/editor | ✅ | HTML контент (EN) |
| SEO Title | text | ⬜ | Мета заголовок |
| SEO Description | text | ⬜ | Мета описание |
| Статус | select | ✅ | draft, published |

---

### 20.4. Меню (CMS Menus)

#### Основные элементы интерфейса

**Заголовок:**
- "Управление меню"
- Кнопка "Создать элемент меню" (справа)

**Таблица элементов меню:**
- Колонки: ID, Название (RU), Название (EN), URL, Тип, Порядок, Действия
- Действия: Редактировать, Удалить

#### API запросы

**Создание:**
- `POST /api/cms/menu-items`

**Чтение:**
- `GET /api/cms/menu-items`

**Обновление:**
- `PUT /api/cms/menu-items/{id}`

**Удаление:**
- `DELETE /api/cms/menu-items/{id}`

#### Структура данных

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| Название (RU) | text | ✅ | Текст пункта меню |
| Название (EN) | text | ✅ | Текст на английском |
| URL | text | ✅ | Ссылка (/tours.html, /about.html) |
| Тип | select | ✅ | header, footer, sidebar |
| Родительский элемент | select | ⬜ | Для вложенных меню |
| Порядок | number | ✅ | Сортировка |
| Открывать в новом окне | checkbox | ⬜ | target="_blank" |
| Иконка | text | ⬜ | Font Awesome класс |

---

## Модуль 21: Translations (Автоматический перевод туров)

### Основные элементы интерфейса

**Статистические карточки:**
- Поддерживаемых языков (6)
- Полностью переведённых туров
- Требует перевода

**Инструменты перевода:**

**1. Перевод одного тура:**
- Выпадающий список туров
- Кнопка "Перевести тур"

**2. Массовый перевод:**
- Кнопка "Перевести все туры"
- Кнопка "Выбрать туры для перевода"

**3. Ручной перевод текста:**
- Выбор исходного языка
- Выбор целевого языка
- Textarea исходного текста
- Textarea переведённого текста
- Кнопка "Перевести"

### Ключевые действия и API-запросы

**Перевод одного тура:**
- `POST /api/translate/tour/{tourId}`
- Переводит title, description, itinerary на недостающие языки

**Массовый перевод:**
- `POST /api/translate/tours/batch`
- Body: `{ tourIds: [1, 2, 3] }`
- Переводит несколько туров параллельно

**Ручной перевод:**
- `POST /api/translate/text`
- Body: `{ text: "...", sourceLanguage: "ru", targetLanguage: "en" }`

### Поддерживаемые языки

1. ru - Русский
2. en - English
3. tj - Тоҷикӣ (Таджикский)
4. fa - فارسی (Farsi/Персидский)
5. de - Deutsch (Немецкий)
6. zh - 中文 (Китайский)

**Использование:**
- AI-powered переводы через OpenAI API
- Автоматическое сохранение в БД
- Поддержка всех многоязычных полей туров

---

## Модуль 22: Settings (Настройки)

### Основные элементы интерфейса

**Секции настроек:**

**1. Общие настройки:**
- Название компании
- Логотип
- Favicon
- Часовой пояс
- Язык по умолчанию

**2. Настройки email:**
- SMTP хост
- SMTP порт
- Email отправителя
- Пароль
- Кнопка "Проверить подключение"

**3. Настройки платежей:**
- Включение/выключение каждого шлюза
- API ключи для каждой системы
- Test/Production режим

**4. Настройки SEO:**
- Google Analytics ID
- Yandex Metrika ID
- Пользовательские мета-теги

### Ключевые действия и API-запросы

**Чтение:**
- `GET /api/settings` - все настройки

**Обновление:**
- `PUT /api/settings/general`
- `PUT /api/settings/email`
- `PUT /api/settings/payment`
- `PUT /api/settings/seo`

### Структура данных

**Общие настройки:**
- Company name
- Logo URL
- Timezone
- Default language
- Default currency

**Email настройки:**
- SMTP host
- SMTP port
- SMTP user
- SMTP password
- From email
- From name

**Payment настройки:**
```javascript
{
  payler: {
    enabled: boolean,
    apiKey: string,
    testMode: boolean
  },
  alifpay: {
    enabled: boolean,
    merchantId: string,
    secretKey: string
  },
  binance: {
    enabled: boolean,
    apiKey: string,
    secretKey: string
  },
  kortiMilli: {
    enabled: boolean,
    merchantId: string
  }
}
```

---

## Общие технические детали

### Аутентификация

**Логин:**
```javascript
POST /api/admin/login
Body: { username: "admin", password: "admin123" }
Response: { success: true, token: "jwt_token" }
```

**Хранение:**
- JWT token в localStorage: `localStorage.setItem('adminToken', token)`
- Проверка при каждом запросе: `headers: { 'Authorization': 'Bearer ' + token }`

**Выход:**
```javascript
function logout() {
  localStorage.removeItem('adminToken');
  location.reload();
}
```

### Утилиты

**1. Безопасный парсинг JSON:**
```javascript
function safeJsonParse(jsonString) {
  if (!jsonString) return null;
  if (typeof jsonString === 'object') return jsonString;
  try {
    return JSON.parse(jsonString);
  } catch (error) {
    console.warn('JSON parsing error:', error);
    return null;
  }
}
```

**2. Безопасное получение значений:**
```javascript
function safeGetValue(elementId, defaultValue = '', parseType = null) {
  const element = document.getElementById(elementId);
  if (!element) {
    console.warn(`Element with ID "${elementId}" not found`);
    return defaultValue;
  }
  
  let value = element.type === 'checkbox' ? element.checked : element.value;
  
  if (parseType === 'int') return parseInt(value) || defaultValue;
  if (parseType === 'float') return parseFloat(value) || defaultValue;
  
  return value || defaultValue;
}
```

**3. Получение API URL:**
```javascript
function getApiUrl() {
  return window.location.origin + '/api';
}
```

**4. Заголовки авторизации:**
```javascript
function getAuthHeaders() {
  const token = localStorage.getItem('adminToken');
  return {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  };
}
```

### ObjectUploader (Загрузка файлов)

**Инициализация:**
```javascript
const uploader = new ObjectUploader({
  maxFiles: 10,
  maxFileSize: 10 * 1024 * 1024, // 10MB
  onComplete: (fileInfo, allFiles) => {
    console.log('Uploaded:', fileInfo.url);
  },
  onError: (error) => {
    alert('Ошибка загрузки: ' + error);
  }
});

uploader.createElement('container-id');
```

**Нормализация путей:**
```javascript
fetch('/api/images', {
  method: 'PUT',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ imageURL: fileInfo.url })
})
.then(res => res.json())
.then(data => {
  if (data.success) {
    const normalizedPath = data.objectPath;
    // Используйте normalizedPath для сохранения в БД
  }
});
```

### Многоязычность

**Инициализация:**
```javascript
// Подключение центральной системы i18n
<script src="/public/js/i18n.js"></script>

// Переключение языка
function switchAdminLanguage(lang) {
  if (typeof switchSiteLanguage === 'function') {
    switchSiteLanguage(lang);
  }
  translateAdminInterface(lang);
}
```

**Использование:**
```html
<!-- HTML атрибут -->
<span data-translate="admin.tours">Туры</span>

<!-- JavaScript -->
const translation = getTranslation('admin.tours', 'ru');
```

### Модальные окна

**Открытие:**
```javascript
function openModal(modalId) {
  document.getElementById(modalId).classList.add('active');
}
```

**Закрытие:**
```javascript
function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('active');
}
```

**Структура:**
```html
<div id="myModal" class="modal">
  <div class="modal-content">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-semibold">Заголовок</h2>
      <button onclick="closeModal('myModal')">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <!-- Содержимое модального окна -->
  </div>
</div>
```

### Обработка ошибок

**Успешные сообщения:**
```javascript
function showSuccessMessage(message) {
  alert(message); // Простая реализация
  // TODO: Использовать toast notifications
}
```

**Сообщения об ошибках:**
```javascript
function showErrorMessage(message) {
  alert('Ошибка: ' + message);
}
```

---

## Заключение

Админ-панель Bunyod-Tour представляет собой **полнофункциональную систему управления** туристической платформой с 22 модулями, охватывающими все аспекты бизнеса:

✅ **Управление контентом**: туры, отели, категории, новости, CMS
✅ **Операционное управление**: заказы, платежи, отзывы
✅ **Управление персоналом**: гиды, водители, турагенты
✅ **Логистика**: поездки, трансферы
✅ **Справочники**: страны, города, курсы валют
✅ **Ценообразование**: компонентная система цен
✅ **Интернационализация**: AI-powered переводы на 6 языков
✅ **Интеграции**: ObjectStorage, платёжные шлюзы

**Связь с публичной частью:**
- Все данные из админки напрямую отображаются на публичных страницах
- Многоязычные поля (JSON) автоматически переключаются при смене языка
- Component-based pricing синхронизирован с booking flow
- Room types и meal types из Hotels → booking-step1.html
- Курсы валют → конвертация на всех страницах
- Tours + Categories → фильтры на tours.html

**Технические особенности:**
- Единый файл 15000+ строк (монолитная архитектура)
- Vanilla JavaScript без фреймворков
- Tailwind CSS для стилизации
- RESTful API через fetch
- JWT аутентификация
- ObjectStorage для файлов
- Centralized i18n system
